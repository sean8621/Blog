# 自适应高度虚拟列表

> 虚拟列表大部分都是固定高度，因此思考不定高度的虚拟列表的实现方式。

## 实现方案

1. 初始化

- 用估算高度初始化 itemHeightCache 和 itemTopCache。
- 计算总高度，设置滚动条高度。

2. 滚动时定位可视区

- 监听滚动事件，获取 scrollTop。
- 通过二分查找在 itemTopCache 中定位当前可视区的起始索引（startIndex）。
- 计算可视区结束索引（endIndex = startIndex + visibleCount）。

3. 渲染可见项

- 只渲染 startIndex ~ endIndex 区间的列表项。
- 用 transform: translate3d(0, scrollTop, 0) 将可见项定位到正确位置。

4. 动态测量与修正

- 每个 item 渲染后，测量真实高度并通过事件上报。
- 若高度有变化，更新 itemHeightCache 和 itemTopCache，并重新计算 scrollBarHeight。
- 若当前滚动位置受影响，自动修正。

## 代码实现

<script setup>
    import AutoSizeVirtualList from './components/AutoSizeVirtualList.vue'
</script>
<preview :article-name="'vue-article'" :comp-name="'AutoSizeVirtualList'">
    <AutoSizeVirtualList />
</preview>
